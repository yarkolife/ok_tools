{% load i18n %}

<div class="date-range-filter-container" style="background: var(--body-bg); border: 1px solid var(--hairline-color); border-radius: 4px; padding: 15px; margin: 10px 0;">

    <!-- Custom date range -->
    <div class="custom-date-range">
        <h4 style="margin: 0 0 10px 0; font-size: 13px; color: var(--body-fg);">{% trans "Custom date range" %}:</h4>
        <form method="get" id="date-filter-form" style="display: flex; align-items: end; gap: 10px; flex-wrap: wrap;">

            <!-- Hidden fields to save other parameters -->
            {% for k, v in spec.form.data.items %}
                {% if k != spec.parameter_name|add:"__gte_0" and k != spec.parameter_name|add:"__gte_1" and k != spec.parameter_name|add:"__lte_0" and k != spec.parameter_name|add:"__lte_1" %}
                    <input type="hidden" name="{{ k }}" value="{{ v }}">
                {% endif %}
            {% endfor %}

            <div>
                <label for="{{ spec.parameter_name }}__gte_0" style="display: block; font-size: 12px; margin-bottom: 3px; color: var(--body-fg);">{% trans "Date from" %}:</label>
                <input type="date"
                       id="{{ spec.parameter_name }}__gte_0"
                       name="{{ spec.parameter_name }}__gte_0"
                       value="{{ spec.form.gte_0.value|default:'' }}"
                       style="padding: 6px; border: 1px solid var(--hairline-color); border-radius: 3px; font-size: 12px; background: var(--body-bg); color: var(--body-fg);">
            </div>

            <div>
                <label for="{{ spec.parameter_name }}__gte_1" style="display: block; font-size: 12px; margin-bottom: 3px; color: var(--body-fg);">{% trans "Time from" %}:</label>
                <input type="time"
                       id="{{ spec.parameter_name }}__gte_1"
                       name="{{ spec.parameter_name }}__gte_1"
                       value="{{ spec.form.gte_1.value|default:'' }}"
                       style="padding: 6px; border: 1px solid var(--hairline-color); border-radius: 3px; font-size: 12px; background: var(--body-bg); color: var(--body-fg);">
            </div>

            <div>
                <label for="{{ spec.parameter_name }}__lte_0" style="display: block; font-size: 12px; margin-bottom: 3px; color: var(--body-fg);">{% trans "Date to" %}:</label>
                <input type="date"
                       id="{{ spec.parameter_name }}__lte_0"
                       name="{{ spec.parameter_name }}__lte_0"
                       value="{{ spec.form.lte_0.value|default:'' }}"
                       style="padding: 6px; border: 1px solid var(--hairline-color); border-radius: 3px; font-size: 12px; background: var(--body-bg); color: var(--body-fg);">
            </div>

            <div>
                <label for="{{ spec.parameter_name }}__lte_1" style="display: block; font-size: 12px; margin-bottom: 3px; color: var(--body-fg);">{% trans "Time to" %}:</label>
                <input type="time"
                       id="{{ spec.parameter_name }}__lte_1"
                       name="{{ spec.parameter_name }}__lte_1"
                       value="{{ spec.form.lte_1.value|default:'' }}"
                       style="padding: 6px; border: 1px solid var(--hairline-color); border-radius: 3px; font-size: 12px; background: var(--body-bg); color: var(--body-fg);">
            </div>

            <div>
                <button type="submit"
                        class="date-filter-btn date-filter-submit"
                        style="padding: 7px 14px;
                               background: var(--button-bg);
                               color: var(--button-fg);
                               border: 1px solid var(--button-border);
                               border-radius: 3px;
                               cursor: pointer;
                               font-size: 12px;">
                    {% trans "Search" %}
                </button>
            </div>

            <div>
                <a href="?{% for k, v in spec.form.data.items %}{% if k != spec.parameter_name|add:'__gte_0' and k != spec.parameter_name|add:'__gte_1' and k != spec.parameter_name|add:'__lte_0' and k != spec.parameter_name|add:'__lte_1' %}{{ k }}={{ v }}&{% endif %}{% endfor %}"
                   class="date-filter-btn date-filter-reset"
                   style="display: inline-block;
                          padding: 7px 14px;
                          background: var(--button-bg);
                          color: var(--button-fg);
                          border: 1px solid var(--button-border);
                          border-radius: 3px;
                          text-decoration: none;
                          font-size: 12px;
                          cursor: pointer;">
                    {% trans "Reset" %}
                </a>
            </div>
        </form>
    </div>

    <!-- Display current filter -->
    {% if spec.form.gte_0.value or spec.form.lte_0.value %}
        <div style="margin-top: 10px; padding: 8px; background: var(--message-success-bg); border: 1px solid var(--message-success-border); border-radius: 3px;">
            <small style="color: var(--message-success-fg);">
                <strong>{% trans "Active filter" %}:</strong>
                {% if spec.form.gte_0.value %}
                    {% trans "from" %} {{ spec.form.gte_0.value }}{% if spec.form.gte_1.value %} {{ spec.form.gte_1.value }}{% endif %}
                {% endif %}
                {% if spec.form.gte_0.value and spec.form.lte_0.value %} â€” {% endif %}
                {% if spec.form.lte_0.value %}
                    {% trans "to" %} {{ spec.form.lte_0.value }}{% if spec.form.lte_1.value %} {{ spec.form.lte_1.value }}{% endif %}
                {% endif %}
            </small>
        </div>
    {% endif %}
</div>

<style>
.date-filter-btn:hover {
    background: var(--button-hover-bg) !important;
    border-color: var(--button-hover-border) !important;
}

.date-filter-btn:focus {
    outline: 2px solid var(--focus-color);
    outline-offset: 2px;
}

.date-range-filter-container input:focus {
    outline: 2px solid var(--focus-color);
    outline-offset: 2px;
}
</style>
