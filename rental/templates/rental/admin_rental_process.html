{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Rental Management" %} - OK Tools</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'img/favicon.ico' %}">

    <link href="{% static 'admin/css/base.css' %}" rel="stylesheet">
    <link href="{% static 'rental/css/admin_rental.css' %}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .collapse-icon {
            transition: transform 0.3s ease;
        }
        [data-bs-toggle="collapse"]:hover {
            background-color: rgba(0, 123, 255, 0.1);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #417690 !important;">
        <div class="container-fluid">
            <a class="navbar-brand text-white" href="#">
                <i class="fas fa-tools me-2"></i>OK Tools - {% trans "Inventory Rental" %}
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white" href="{% url 'admin:index' %}">
                    <i class="fas fa-arrow-left me-1"></i>{% trans "Back to Administration" %}
                </a>
                <a class="nav-link text-white" href="{% url 'rental:rental_stats' %}">
                    <i class="fas fa-chart-bar me-1"></i>{% trans "Statistics" %}
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3 sidebar p-3">
                <h5 class="mb-3"><i class="fas fa-clipboard-list me-2"></i>{% trans "Rental Process" %}</h5>
                <div class="workflow-step active p-3 rounded">
                    <div class="d-flex align-items-center mb-2"><i class="fas fa-user text-primary me-2"></i><strong>1. {% trans "Select User" %}</strong></div>
                    <div class="mb-2"><input type="text" class="form-control form-control-sm search-input" placeholder="{% trans 'Search user...' %}" id="userSearch"></div>
                    <div class="selected-user" id="selectedUser"><div class="alert alert-info py-2 mb-0"><small><i class="fas fa-info-circle me-1"></i>{% trans 'Select user' %}</small></div></div>
                </div>
                <div class="workflow-step p-3 rounded">
                    <div class="d-flex align-items-center mb-2"><i class="fas fa-project-diagram text-secondary me-2"></i><strong>2. {% trans "Project Info" %}</strong></div>
                    <div class="mb-2"><input type="text" name="project_name" class="form-control form-control-sm" placeholder="{% trans 'Project name' %}" disabled></div>
                    <div class="mb-2"><textarea name="purpose" class="form-control form-control-sm" placeholder="{% trans 'Purpose of use' %}" rows="2" disabled></textarea></div>
                </div>
                <div class="workflow-step p-3 rounded">
                    <div class="d-flex align-items-center mb-2"><i class="fas fa-calendar text-secondary me-2"></i><strong>3. {% trans "Time Period" %}</strong></div>
                    <div class="mb-2"><label class="form-label form-label-sm">{% trans "From" %}:</label><input name="start_date" type="datetime-local" class="form-control form-control-sm" disabled></div>
                    <div class="mb-2"><label class="form-label form-label-sm">{% trans "To" %}:</label><input name="end_date" type="datetime-local" class="form-control form-control-sm" disabled></div>
                </div>
                <div class="workflow-step p-3 rounded">
                    <div class="d-flex align-items-center mb-2"><i class="fas fa-boxes text-secondary me-2"></i><strong>4. {% trans "Select Equipment" %}</strong></div>
                    <div class="selected-items" id="selectedItems"><small class="text-muted">{% trans 'No items selected' %}</small></div>
                </div>
                <div class="workflow-step p-3 rounded">
                    <div class="d-flex align-items-center mb-2"><i class="fas fa-play text-secondary me-2"></i><strong>5. {% trans "Action" %}</strong></div>
                    <div class="btn-group-vertical w-100" role="group">
                        <button class="btn btn-outline-primary btn-sm" id="reserveBtn" disabled><i class="fas fa-bookmark me-1"></i>{% trans "Reserve" %}</button>
                        <button class="btn btn-outline-success btn-sm" id="issueBtn" disabled><i class="fas fa-hand-holding me-1"></i>{% trans "Issue Immediately" %}</button>
                    </div>
                    <div class="mt-3">
                        <div class="form-group">
                            <label for="rentalNotes" class="form-label">{% trans "Notes" %}</label>
                            <textarea class="form-control" id="rentalNotes" rows="2" placeholder="{% trans 'Optional notes for the rental' %}"></textarea>
                            <small class="text-muted">{% trans "These notes will be printed on the rental sheet" %}</small>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>{% trans "Note: Rooms are automatically reserved and will return after the scheduled time." %}
                        </small>
                    </div>
                </div>
            </div>

            <div class="col-lg-9 main-content p-3">
                <div class="quick-filters p-3 mb-3">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <div class="input-group search-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" placeholder="{% trans 'Search inventory...' %}" id="inventorySearch">
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select filter-select" id="ownerFilter">
                                <option value="all">{% trans "All Owners" %}</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select filter-select" id="categoryFilter">
                                <option value="all">{% trans "All Categories" %}</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select filter-select" id="locationFilter">
                                <option value="all">{% trans "All Locations" %}</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-success w-100 mb-2" id="roomsFilterBtn"><i class="fas fa-building me-1"></i>{% trans "Rooms" %}</button>
                            <button class="btn btn-outline-primary w-100" id="setsFilterBtn"><i class="fas fa-layer-group me-1"></i>{% trans "Equipment Sets" %}</button>
                        </div>
                    </div>
                </div>

                <div class="user-selection-panel">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0"><i class="fas fa-users me-2"></i>{% trans "Select User" %}</h5></div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="list-group user-list" style="max-height: 400px; overflow-y: auto;" id="userResults"></div>
                                </div>
                                <div class="col-md-6">
                                    <div class="user-stats"><h6>{% trans "User Statistics" %}</h6><div id="userStats"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="inventory-selection-panel d-none">
                    <div class="card">
                        <div class="card-header"><h5 class="mb-0"><i class="fas fa-boxes me-2"></i>{% trans "Available Inventory" %}</h5></div>
                        <div class="card-body"><div class="inventory-grid"><div class="row" id="inventoryGrid"></div></div></div>
                    </div>
                </div>

                <div class="action-buttons">
                    <div class="d-flex justify-content-between">
                        <div>
                            <button class="btn btn-outline-secondary me-2" id="clearFormBtn"><i class="fas fa-eraser me-1"></i>{% trans "Reset Form" %}</button>
                            <button class="btn btn-outline-info" id="groupByLocationBtn"><i class="fas fa-sitemap me-1"></i>{% trans "Group by Location" %}</button>
                        </div>
                        <div>
                            <button class="btn btn-outline-warning me-2" id="showSetsBtn"><i class="fas fa-layer-group me-1"></i>{% trans "Show Equipment Sets" %}</button>
                            <button class="btn btn-outline-success me-2" id="loadTemplateBtn" title="{% trans 'Load from Template' %}"><i class="fas fa-folder-open"></i></button>
                            <button class="btn btn-outline-primary" id="saveDraftBtn"><i class="fas fa-save me-1"></i>{% trans "Save as Template" %}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Rentals Modal -->
    <div class="modal fade" id="activeRentalsModal" tabindex="-1" aria-labelledby="activeRentalsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="activeRentalsModalLabel"><i class="fas fa-clock me-2"></i>{% trans "Active Rentals" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="activeRentalsContent">
                        <div class="text-center p-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="ms-2">{% trans 'Loading active rentals...' %}</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Returned Rentals Modal -->
    <div class="modal fade" id="returnedRentalsModal" tabindex="-1" aria-labelledby="returnedRentalsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="returnedRentalsModalLabel"><i class="fas fa-check-circle me-2"></i>{% trans "Returned Rentals" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="returnedRentalsContent">
                        <div class="text-center p-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="ms-2">{% trans 'Loading returned rentals...' %}</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Overdue Rentals Modal -->
    <div class="modal fade" id="overdueRentalsModal" tabindex="-1" aria-labelledby="overdueRentalsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="overdueRentalsModalLabel"><i class="fas fa-exclamation-triangle me-2"></i>{% trans "Overdue Rentals" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="overdueRentalsContent">
                        <div class="text-center p-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="ms-2">{% trans 'Loading overdue rentals...' %}</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Return Items Modal -->
    <div class="modal fade" id="returnItemsModal" tabindex="-1" aria-labelledby="returnItemsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="returnItemsModalLabel"><i class="fas fa-undo me-2"></i>{% trans "Return Items" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="returnItemsContent">
                        <!-- Return items will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                    <button type="button" class="btn btn-success" id="processReturnBtn">{% trans "Process Return" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Extend Rental Modal -->
    <div class="modal fade" id="extendRentalModal" tabindex="-1" aria-labelledby="extendRentalModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="extendRentalModalLabel"><i class="fas fa-calendar-plus me-2"></i>{% trans "Extend Rental" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">{% trans "Rental" %}:</label>
                        <div class="border rounded p-2 bg-light" id="extendRentalInfo">
                            <!-- Rental info will be loaded here -->
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{% trans "Current End Date" %}:</label>
                        <div class="border rounded p-2 bg-light" id="extendCurrentEndDate">
                            <!-- Current end date will be loaded here -->
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{% trans "New End Date" %}:</label>
                        <input type="datetime-local" class="form-control" id="extendNewEndDate">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">{% trans "Reason for Extension (optional)" %}:</label>
                        <textarea class="form-control" id="extendReason" rows="2" placeholder="{% trans 'Reason for extension...' %}"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                    <button type="button" class="btn btn-primary" id="confirmExtendBtn">{% trans "Extend" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Equipment Sets Modal -->
    <div class="modal fade" id="equipmentSetsModal" tabindex="-1" aria-labelledby="equipmentSetsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="equipmentSetsModalLabel"><i class="fas fa-layer-group me-2"></i>{% trans "Equipment Sets" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>{% trans "Available Sets" %}</h6>
                            <div class="list-group" id="equipmentSetsList" style="max-height: 400px; overflow-y: auto;">
                                <div class="text-center p-3">
                                    <div class="spinner-border spinner-border-sm" role="status"></div>
                                    <small class="ms-2">{% trans 'Loading sets...' %}</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>{% trans "Set Contents" %}</h6>
                            <div id="setDetailsPanel" class="border rounded p-3" style="min-height: 200px;">
                                <small class="text-muted">{% trans 'Select a set to see contents' %}</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                    <button type="button" class="btn btn-primary" id="addSetToRentalBtn" disabled>{% trans "Add Set to Rental" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rooms Modal -->
    <div class="modal fade" id="roomsModal" tabindex="-1" aria-labelledby="roomsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="roomsModalLabel"><i class="fas fa-building me-2"></i>{% trans "Available Rooms" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Navigation tabs -->
                    <ul class="nav nav-tabs mb-3" id="roomsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="rooms-list-tab" data-bs-toggle="tab" data-bs-target="#rooms-list" type="button" role="tab">
                                <i class="fas fa-list me-1"></i>{% trans "List" %}
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="rooms-calendar-tab" data-bs-toggle="tab" data-bs-target="#rooms-calendar" type="button" role="tab">
                                <i class="fas fa-calendar me-1"></i>{% trans "Calendar" %}
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="rooms-timeline-tab" data-bs-toggle="tab" data-bs-target="#rooms-timeline" type="button" role="tab">
                                <i class="fas fa-clock me-1"></i>{% trans "Timeline" %}
                            </button>
                        </li>
                    </ul>

                    <!-- Tab content -->
                    <div class="tab-content" id="roomsTabContent">
                        <!-- Rooms List Tab -->
                        <div class="tab-pane fade show active" id="rooms-list" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>{% trans "Available Rooms" %}</h6>
                                    <div class="list-group" id="roomsList" style="max-height: 400px; overflow-y: auto;">
                                        <div class="text-center p-3">
                                            <div class="spinner-border spinner-border-sm" role="status"></div>
                                            <small class="ms-2">{% trans 'Loading rooms...' %}</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>{% trans "Scheduling" %}</h6>
                                    <div id="roomDetailsPanel" class="border rounded p-3" style="min-height: 200px;">
                                        <small class="text-muted">{% trans 'Select a room to schedule time' %}</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Calendar Tab -->
                        <div class="tab-pane fade" id="rooms-calendar" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">{% trans "Select Room" %}:</label>
                                    <select class="form-select" id="calendarRoomSelect">
                                        <option value="">{% trans "All Rooms" %}</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">{% trans "From" %}:</label>
                                    <input type="date" class="form-control" id="calendarStartDate">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">{% trans "To" %}:</label>
                                    <input type="date" class="form-control" id="calendarEndDate">
                                </div>
                            </div>
                            <div id="calendarContainer" class="border rounded p-3" style="min-height: 500px;">
                                <div class="text-center p-5">
                                    <div class="spinner-border" role="status"></div>
                                    <p class="mt-2">{% trans 'Loading calendar...' %}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Timeline Tab -->
                        <div class="tab-pane fade" id="rooms-timeline" role="tabpanel">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">{% trans "Select Room" %}:</label>
                                    <select class="form-select" id="timelineRoomSelect">
                                        <option value="">{% trans "All Rooms" %}</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">{% trans "Date" %}:</label>
                                    <input type="date" class="form-control" id="timelineDate">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-primary mt-4" id="refreshTimelineBtn">
                                        <i class="fas fa-sync-alt me-1"></i>{% trans "Refresh" %}
                                    </button>
                                </div>
                            </div>
                            <div id="timelineContainer" class="border rounded p-3" style="min-height: 500px;">
                                <div class="text-center p-5">
                                    <div class="spinner-border" role="status"></div>
                                    <p class="mt-2">{% trans 'Loading timeline...' %}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="text-start me-auto">
                        <small class="text-info">
                            <i class="fas fa-info-circle me-1"></i>{% trans "Rooms are automatically reserved and will return after the scheduled time." %}
                        </small>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                    <button type="button" class="btn btn-success" id="addRoomToRentalBtn" disabled>{% trans "Add Room to Rental" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Issue from Reservation Modal -->
    <div class="modal fade" id="issueFromReservationModal" tabindex="-1" aria-labelledby="issueFromReservationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="issueFromReservationModalLabel">
                        <i class="fas fa-box-open me-2"></i>{% trans "Issue Equipment from Reservation" %}
                        <small class="d-block text-muted mt-1">{% trans "Rooms remain reserved and are not issued" %}</small>
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-boxes me-2"></i>{% trans "Equipment Items" %}</h6>
                            <div id="issueItemsList" class="mb-3">
                                <!-- Items will be rendered here -->
                            </div>
                        </div>
                        <div class="col-md-6">
                                                                <h6><i class="fas fa-building me-2"></i>{% trans "Rooms (Reserved Only)" %}</h6>
                            <div id="issueRoomsList" class="mb-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>{% trans "Note:" %}</strong> {% trans "Rooms cannot be issued - they remain reserved and are automatically available after the scheduled time." %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="issueStartDate" class="form-label">{% trans "Start Date" %}</label>
                                <input type="date" class="form-control" id="issueStartDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="issueEndDate" class="form-label">{% trans "End Date" %}</label>
                                <input type="date" class="form-control" id="issueEndDate" required>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="issueStartTime" class="form-label">{% trans "Start Time" %}</label>
                                <select class="form-select" id="issueStartTime" required>
                                    <option value="">{% trans "Select time" %}</option>
                                    <option value="08:00">08:00</option>
                                    <option value="08:30">08:30</option>
                                    <option value="09:00">09:00</option>
                                    <option value="09:30">09:30</option>
                                    <option value="10:00">10:00</option>
                                    <option value="10:30">10:30</option>
                                    <option value="11:00">11:00</option>
                                    <option value="11:30">11:30</option>
                                    <option value="12:00">12:00</option>
                                    <option value="12:30">12:30</option>
                                    <option value="13:00">13:00</option>
                                    <option value="13:30">13:30</option>
                                    <option value="14:00">14:00</option>
                                    <option value="14:30">14:30</option>
                                    <option value="15:00">15:00</option>
                                    <option value="15:30">15:30</option>
                                    <option value="16:00">16:00</option>
                                    <option value="16:30">16:30</option>
                                    <option value="17:00">17:00</option>
                                    <option value="17:30">17:30</option>
                                    <option value="18:00">18:00</option>
                                    <option value="18:30">18:30</option>
                                    <option value="19:00">19:00</option>
                                    <option value="19:30">19:30</option>
                                    <option value="20:00">20:00</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="issueEndTime" class="form-label">{% trans "End Time" %}</label>
                                <select class="form-select" id="issueEndTime" required>
                                    <option value="">{% trans "Select time" %}</option>
                                    <option value="08:00">08:00</option>
                                    <option value="08:30">08:30</option>
                                    <option value="09:00">09:00</option>
                                    <option value="09:30">09:30</option>
                                    <option value="10:00">10:00</option>
                                    <option value="10:30">10:30</option>
                                    <option value="11:00">11:00</option>
                                    <option value="11:30">11:30</option>
                                    <option value="12:00">12:00</option>
                                    <option value="12:30">12:30</option>
                                    <option value="13:00">13:00</option>
                                    <option value="13:30">13:30</option>
                                    <option value="14:00">14:00</option>
                                    <option value="14:30">14:30</option>
                                    <option value="15:00">15:00</option>
                                    <option value="15:30">15:30</option>
                                    <option value="16:00">16:00</option>
                                    <option value="16:30">16:30</option>
                                    <option value="17:00">17:00</option>
                                    <option value="17:30">17:30</option>
                                    <option value="18:00">18:00</option>
                                    <option value="18:30">18:30</option>
                                    <option value="19:00">19:00</option>
                                    <option value="19:30">19:30</option>
                                    <option value="20:00">20:00</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="issueCreatedBy" class="form-label">{% trans "Created by" %}</label>
                                <select class="form-select" id="issueCreatedBy" required>
                                    <option value="">{% trans "Select staff member" %}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="issueNotes" class="form-label">{% trans "Notes" %}</label>
                                <textarea class="form-control" id="issueNotes" rows="2" placeholder="{% trans 'Optional notes' %}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                    <button type="button" class="btn btn-primary" id="processIssueFromReservationBtn">
                                                        <i class="fas fa-check me-2"></i>{% trans "Issue Equipment" %}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addItemModalLabel">
                        <i class="fas fa-plus me-2"></i>{% trans "Add Equipment to Issue" %}
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="addItemSearch" class="form-label">{% trans "Search by inventory number or description" %}</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="addItemSearch" placeholder="{% trans 'Search...' %}">
                            <button class="btn btn-outline-secondary" type="button" id="searchItemsBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div id="addItemItemsList" style="max-height: 500px; overflow-y: auto;">
                        <div class="text-center p-3">
                            <div class="spinner-border spinner-border-sm" role="status"></div>
                            <small class="ms-2">{% trans 'Loading available items...' %}</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="text-start me-auto">
                        <small class="text-info">
                            <i class="fas fa-info-circle me-1"></i>{% trans "Click '+' to add items. Modal stays open for multiple selections." %}
                        </small>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript translations -->
    <script src="{% url 'javascript-catalog' %}"></script>

    <script>
        const URLS = {
            searchUsers: "{% url 'rental:api_search_users' %}",
            getUserInventory: "{% url 'rental:api_user_inventory' user_id=0 %}".replace('0','{userId}'),
            getUserStats: "{% url 'rental:api_user_stats' user_id=0 %}".replace('0','{userId}'),
            createRental: "{% url 'rental:api_create_rental' %}",
            getUserActiveItems: "{% url 'rental:api_user_active_items' user_id=0 %}".replace('0','{userId}'),
            returnItems: "{% url 'rental:api_return_items' %}",
            filterOptions: "{% url 'rental:api_filter_options' %}",
            equipmentSets: "/rental/api/equipment-sets-available/",
            equipmentSetDetails: "/rental/api/equipment-set/{setId}/details/",
            rooms: "/rental/api/rooms-available/",
            roomSchedule: "/rental/api/room-schedule/",
            userRentalDetails: "{% url 'rental:api_user_rental_details' user_id=0 %}".replace('0','{userId}'),
            cancelRental: "{% url 'rental:api_cancel_rental' %}",
            extendRental: "{% url 'rental:api_extend_rental' %}",
            returnRentalItems: "{% url 'rental:api_return_rental_items' %}",
            rentalPrintInfo: "{% url 'rental:api_rental_print_info' rental_id=0 %}".replace('0','{rentalId}'),
            printFormMSA: "{% url 'rental:print_form_msa' rental_id=0 %}".replace('0','{rentalId}'),
            printFormOKMQ: "{% url 'rental:print_form_okmq' rental_id=0 %}".replace('0','{rentalId}'),
            checkRoomAvailability: "{% url 'rental:api_check_room_availability' %}",
            issueFromReservation: "{% url 'rental:api_issue_from_reservation' %}",
            getStaffUsers: "{% url 'rental:api_get_staff_users' %}",
            searchInventory: "{% url 'rental:api_search_inventory' %}",
            saveTemplate: "{% url 'rental:api_save_template' %}",
            getTemplates: "{% url 'rental:api_get_templates' %}",
            loadTemplate: "{% url 'rental:api_load_template' template_id=0 %}".replace('/0/', '/'),
            deleteTemplate: "{% url 'rental:api_delete_template' template_id=0 %}".replace('/0/', '/')
        };
        const CSRF_TOKEN = "{{ csrf_token }}";
    </script>
    <script src="{% static 'rental/js/admin_rental.js' %}"></script>
</body>
</html>
