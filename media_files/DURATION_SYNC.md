# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–∑ –≤–∏–¥–µ–æ

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–∏ (License.duration) —Å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞ (VideoFile.duration).

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:

1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ VideoFile** —Å –Ω–æ–º–µ—Ä–æ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–∏—Ü–µ–Ω–∑–∏–∏
2. **–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ VideoFile** –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ
3. **–ü—Ä–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏ VideoFile —Å License**

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```python
# –°–∏–≥–Ω–∞–ª –≤ media_files/signals.py –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –ù–∞—Ö–æ–¥–∏—Ç License –ø–æ –Ω–æ–º–µ—Ä—É VideoFile
# 2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
# 3. –û–±–Ω–æ–≤–ª—è–µ—Ç License.duration –µ—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
```

## üìä –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### –í –∞–¥–º–∏–Ω–∫–µ License:

–í —Å–µ–∫—Ü–∏–∏ **"Status & Metadata"** ‚Üí –ø–æ–ª–µ **"Video File"**:

#### ‚úÖ –ï—Å–ª–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç:
```
üé¨ 99999_test_video.mp4
0:00:15.568167 ‚Ä¢ 848x478 ‚Ä¢ 2.38 MB
‚úì Available ‚Ä¢ Local Test Playout
```

#### ‚ö†Ô∏è –ï—Å–ª–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ù–ï —Å–æ–≤–ø–∞–¥–∞—é—Ç:
```
üé¨ 99999_test_video.mp4
0:00:15.568167 ‚Ä¢ 848x478 ‚Ä¢ 2.38 MB
‚úì Available ‚Ä¢ Local Test Playout
‚ö†Ô∏è Duration mismatch: License (0:00:30)
[üîÑ Sync from Video]  ‚Üê –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

## üîÑ –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –°–ø–æ—Å–æ–± 1: –ö–Ω–æ–ø–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ

1. –û—Ç–∫—Ä–æ–π –ª–∏—Ü–µ–Ω–∑–∏—é: `http://localhost:8000/admin/licenses/license/1/change/`
2. –†–∞–∑–≤–µ—Ä–Ω–∏ —Å–µ–∫—Ü–∏—é **"Status & Metadata"**
3. –ù–∞–π–¥–∏ –ø–æ–ª–µ **"Video File"**
4. –ï—Å–ª–∏ –≤–∏–¥–∏—à—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚ö†Ô∏è ‚Äî –∫–ª–∏–∫–Ω–∏ –∫–Ω–æ–ø–∫—É **"üîÑ Sync from Video"**
5. –ü–æ–ª—É—á–∏—à—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `Duration synced from video: 0:00:30 ‚Üí 0:00:15.568167`

### –°–ø–æ—Å–æ–± 2: –ü–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω–∏ VideoFile

1. –û—Ç–∫—Ä–æ–π –≤–∏–¥–µ–æ—Ñ–∞–π–ª: `http://localhost:8000/admin/media_files/videofile/1/change/`
2. –ö–ª–∏–∫–Ω–∏ **"Save"**
3. –°–∏–≥–Ω–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç License.duration

### –°–ø–æ—Å–æ–± 3: Django Shell

```bash
docker-compose exec web python manage.py shell
```

```python
from licenses.models import License

license = License.objects.get(number=99999)
video = license.get_video_file()

if video and video.duration:
    license.duration = video.duration
    license.save(update_fields=['duration'])
    print(f"‚úÖ Synced: {license.duration}")
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å–∏—Ç—É–∞—Ü–∏—é —Å –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ–º:

```bash
docker-compose exec -T web python manage.py shell <<'EOF'
from licenses.models import License
from datetime import timedelta

license = License.objects.get(number=99999)
license.duration = timedelta(seconds=999)  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
license.save(update_fields=['duration'])
print("Test created: license.duration != video.duration")
EOF
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:

1. –û—Ç–∫—Ä–æ–π –ª–∏—Ü–µ–Ω–∑–∏—é –≤ –∞–¥–º–∏–Ω–∫–µ
2. –£–≤–∏–¥–∏—à—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚ö†Ô∏è
3. –ö–ª–∏–∫–Ω–∏ "üîÑ Sync from Video"
4. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üìù –õ–æ–≥–∏

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```bash
docker-compose logs web | grep "Synced duration"
```

–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:
```
INFO Synced duration from VideoFile to License #99999: 0:00:15.568167
INFO Auto-linked VideoFile 99999 to License
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `video.duration` –Ω–µ `None`
- ‚úÖ –ù–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `duration`, –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—è –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `update_fields=['duration']` –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ë–î

## üé¨ Workflow

### –¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. **–°–æ–∑–¥–∞—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—é** —Å –ª—é–±–æ–π –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é (–∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π)
2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ** —Å —Ç–µ–º –∂–µ –Ω–æ–º–µ—Ä–æ–º —á–µ—Ä–µ–∑:
   - –†—É—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –≤ –∞–¥–º–∏–Ω–∫–µ
   - –ö–æ–º–∞–Ω–¥—É `scan_video_storage`
   - –ü—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ VideoFile
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** License.duration –æ–±–Ω–æ–≤–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏–∑ –≤–∏–¥–µ–æ
4. **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫—É "üîÑ Sync from Video"

### –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–∏–¥–µ–æ:

1. –ó–∞–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫–µ
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å: `python manage.py update_video_metadata`
3. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## ‚ùì FAQ

**Q: –ß—Ç–æ –µ—Å–ª–∏ —É –ª–∏—Ü–µ–Ω–∑–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤?**  
A: `get_video_file()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤—ã–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π VideoFile —Å —Å–æ–≤–ø–∞–¥–∞—é—â–∏–º –Ω–æ–º–µ—Ä–æ–º.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é?**  
A: –î–∞, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å–∏–≥–Ω–∞–ª `auto_link_to_license` –≤ `media_files/signals.py`.

**Q: –ö–∞–∫ —É–∑–Ω–∞—Ç—å –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å?**  
A: –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –∏–ª–∏ –¥–æ–±–∞–≤—å –ø–æ–ª–µ `duration_updated_at` –≤ –º–æ–¥–µ–ª—å License.

**Q: –ß—Ç–æ –µ—Å–ª–∏ –≤–∏–¥–µ–æ —É–¥–∞–ª–µ–Ω–æ?**  
A: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–∏—Ü–µ–Ω–∑–∏–∏ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–Ω–µ –æ–±–Ω—É–ª–∏—Ç—Å—è).

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- –°–∏–≥–Ω–∞–ª: `media_files/signals.py` ‚Üí `auto_link_to_license()`
- –ê–¥–º–∏–Ω–∫–∞: `licenses/admin.py` ‚Üí `video_file_info()`, `response_change()`
- –ú–æ–¥–µ–ª—å: `licenses/models.py` ‚Üí `get_video_file()`

---

**–í–µ—Ä—Å–∏—è**: 2.5  
**–î–∞—Ç–∞**: October 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Production Ready

