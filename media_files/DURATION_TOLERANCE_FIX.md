# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¢–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–Ω–∏—Ü–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "Duration mismatch" –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å –¥–∞–∂–µ –ø—Ä–∏ —Ä–∞–∑–Ω–∏—Ü–µ –º–µ–Ω–µ–µ —Å–µ–∫—É–Ω–¥—ã
- –í–∏–¥–µ–æ: `0:00:15.568167` vs –õ–∏—Ü–µ–Ω–∑–∏—è: `0:00:15` ‚Äî —Ä–∞–∑–Ω–∏—Ü–∞ 0.568 —Å–µ–∫—É–Ω–¥—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–ª –ª–æ–∂–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –õ–æ–≥–∏–∫–∞ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç–∏:
**–ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ < 1 —Å–µ–∫—É–Ω–¥—ã ‚Üí —Å—á–∏—Ç–∞–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è)**

### –ü—Ä–∏–º–µ—Ä—ã:

#### ‚úÖ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
Video: 0:00:15.568167  (15 —Å–µ–∫—É–Ω–¥)
License: 0:00:15       (15 —Å–µ–∫—É–Ω–¥)
Difference: 0 —Å–µ–∫—É–Ω–¥   ‚Üí –ù–ï–¢ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
```

```
Video: 0:00:15.999     (15 —Å–µ–∫—É–Ω–¥)
License: 0:00:15       (15 —Å–µ–∫—É–Ω–¥) 
Difference: 0 —Å–µ–∫—É–Ω–¥   ‚Üí –ù–ï–¢ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
```

#### ‚ö†Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:
```
Video: 0:00:15.568167  (15 —Å–µ–∫—É–Ω–¥)
License: 0:00:20       (20 —Å–µ–∫—É–Ω–¥)
Difference: 5 —Å–µ–∫—É–Ω–¥   ‚Üí –ï–°–¢–¨ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. **–ê–¥–º–∏–Ω–∫–∞ License** (`licenses/admin.py`)
```python
# Check if duration needs sync (only if difference >= 1 second)
if video_file.duration and obj.duration:
    # Calculate difference in seconds
    video_seconds = int(video_file.duration.total_seconds())
    license_seconds = int(obj.duration.total_seconds())
    duration_diff = abs(video_seconds - license_seconds)
    
    # Only show warning if difference is 1 second or more
    if duration_diff >= 1:
        # –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```

### 2. **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** (`media_files/signals.py`)
```python
# Only sync if difference is 1 second or more
if license.duration:
    video_seconds = int(video_duration.total_seconds())
    license_seconds = int(license.duration.total_seconds())
    duration_diff = abs(video_seconds - license_seconds)
    
    if duration_diff >= 1:
        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
        license.duration = rounded_duration
    else:
        # –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —Ä–∞–∑–Ω–∏—Ü–∞ < 1 —Å–µ–∫—É–Ω–¥—ã
        logger.debug("Duration difference < 1 second, no sync needed")
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –†–∞–∑–Ω–∏—Ü–∞ < 1 —Å–µ–∫—É–Ω–¥—ã
```bash
docker-compose exec web python manage.py shell
```
```python
from licenses.models import License
from datetime import timedelta

license = License.objects.get(number=99999)
license.duration = timedelta(seconds=15)  # 0:00:15
# Video: 0:00:15.568167
# –†–∞–∑–Ω–∏—Ü–∞: 0 —Å–µ–∫—É–Ω–¥

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–ï–¢ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ
```

### –¢–µ—Å—Ç 2: –†–∞–∑–Ω–∏—Ü–∞ >= 1 —Å–µ–∫—É–Ω–¥—ã
```python
license.duration = timedelta(seconds=20)  # 0:00:20
# Video: 0:00:15.568167
# –†–∞–∑–Ω–∏—Ü–∞: 5 —Å–µ–∫—É–Ω–¥

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ï–°–¢–¨ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –∞–¥–º–∏–Ω–∫–µ
```

---

## üìä –ü–æ–≤–µ–¥–µ–Ω–∏–µ

### –í –∞–¥–º–∏–Ω–∫–µ License:

#### –ö–æ–≥–¥–∞ —Ä–∞–∑–Ω–∏—Ü–∞ < 1 —Å–µ–∫—É–Ω–¥—ã:
```
Video File: üé¨ 99999_test_video.mp4
           0:00:15.568167 ‚Ä¢ 848x478 ‚Ä¢ 2.38 MB
           ‚úì Available ‚Ä¢ Local Test Playout
           ‚Üê –ù–ï–¢ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
```

#### –ö–æ–≥–¥–∞ —Ä–∞–∑–Ω–∏—Ü–∞ >= 1 —Å–µ–∫—É–Ω–¥—ã:
```
Video File: üé¨ 99999_test_video.mp4
           0:00:15.568167 ‚Ä¢ 848x478 ‚Ä¢ 2.38 MB
           ‚úì Available ‚Ä¢ Local Test Playout
           ‚ö†Ô∏è Duration mismatch: License (0:00:20)
           [üîÑ Sync from Video] ‚Üê –ï–°–¢–¨ –∫–Ω–æ–ø–∫–∞
```

### –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:

#### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ VideoFile:
- ‚úÖ –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ >= 1 —Å–µ–∫—É–Ω–¥—ã ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç
- ‚úÖ –ï—Å–ª–∏ —Ä–∞–∑–Ω–∏—Ü–∞ < 1 —Å–µ–∫—É–Ω–¥—ã ‚Üí –ù–ï —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç (—Å—á–∏—Ç–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏)

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–£–±—Ä–∞–Ω—ã –ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** –ø—Ä–∏ —Ä–∞–∑–Ω–∏—Ü–µ < 1 —Å–µ–∫—É–Ω–¥—ã  
‚úÖ **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —É–º–Ω–æ** ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–ª–∏—á–∏—è—Ö  
‚úÖ **–ö–Ω–æ–ø–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è** —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ  
‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∞–º** –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑–ª–∏—á–∏—è—Ö  

---

## üîó –ü—Ä–æ–≤–µ—Ä—å:

**–û—Ç–∫—Ä–æ–π:** http://localhost:8000/admin/licenses/license/1/change/

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- License: `0:00:20` 
- Video: `0:00:15.568167`
- –†–∞–∑–Ω–∏—Ü–∞: 5 —Å–µ–∫—É–Ω–¥ ‚Üí **–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ**

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–≤–µ—Ä–Ω–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å):**
```bash
docker-compose exec -T web python manage.py shell <<'EOF'
from licenses.models import License
from datetime import timedelta
license = License.objects.get(number=99999)
license.duration = timedelta(seconds=15)
license.save(update_fields=['duration'])
print("Duration reset to 0:00:15")
EOF
```

---

**–î–∞—Ç–∞**: October 12, 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Fixed
