{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans 'Inventory' %} - OK Tools{% endblock %}
{% block page_title %}{% trans 'Inventory' %}{% endblock %}

{% block content %}
<!-- Header Actions -->
<div class="row mb-4">
    <div class="col-md-6">
        <h5 class="text-muted">{% trans 'Manage your equipment and inventory items' %}</h5>
    </div>
    <div class="col-md-6 text-end">
        <a href="#" class="btn btn-outline-primary me-2">
            <i class="bi bi-upload me-2"></i>{% trans 'Import' %}
        </a>
        <a href="#" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>{% trans 'Add Item' %}
        </a>
    </div>
</div>

<!-- Stats Overview -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="dashboard-card stats-card text-center">
            <div class="stats-icon info">
                <i class="bi bi-box-seam"></i>
            </div>
            <div class="stats-number">{{ total_items|default:0 }}</div>
            <div class="stats-label">{% trans 'Total Items' %}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card stats-card text-center">
            <div class="stats-icon success">
                <i class="bi bi-check-circle"></i>
            </div>
            <div class="stats-number">{{ available_items|default:0 }}</div>
            <div class="stats-label">{% trans 'Available' %}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card stats-card text-center">
            <div class="stats-icon warning">
                <i class="bi bi-clock"></i>
            </div>
            <div class="stats-number">{{ rented_items|default:0 }}</div>
            <div class="stats-label">{% trans 'Rented' %}</div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="dashboard-card stats-card text-center">
            <div class="stats-icon danger">
                <i class="bi bi-exclamation-triangle"></i>
            </div>
            <div class="stats-number">{{ maintenance_items|default:0 }}</div>
            <div class="stats-label">{% trans 'Maintenance' %}</div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="dashboard-card mb-4">
    <div class="row">
        <div class="col-md-2">
            <label for="categoryFilter" class="form-label">{% trans 'Category' %}</label>
            <select class="form-select" id="categoryFilter">
                <option value="">{% trans 'All Categories' %}</option>
                <option value="camera">{% trans 'Camera' %}</option>
                <option value="audio">{% trans 'Audio' %}</option>
                <option value="lighting">{% trans 'Lighting' %}</option>
                <option value="computer">{% trans 'Computer' %}</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="statusFilter" class="form-label">{% trans 'Status' %}</label>
            <select class="form-select" id="statusFilter">
                <option value="">{% trans 'All Statuses' %}</option>
                <option value="available">{% trans 'Available' %}</option>
                <option value="rented">{% trans 'Rented' %}</option>
                <option value="maintenance">{% trans 'Maintenance' %}</option>
                <option value="reserved">{% trans 'Reserved' %}</option>
            </select>
        </div>
        <div class="col-md-2">
            <label for="locationFilter" class="form-label">{% trans 'Location' %}</label>
            <select class="form-select" id="locationFilter">
                <option value="">{% trans 'All Locations' %}</option>
                <option value="storage">{% trans 'Storage' %}</option>
                <option value="studio">{% trans 'Studio' %}</option>
                <option value="office">{% trans 'Office' %}</option>
            </select>
        </div>
        <div class="col-md-3">
            <label for="searchInput" class="form-label">{% trans 'Search' %}</label>
            <input type="text" class="form-control" id="searchInput" placeholder="{% trans 'Search items...' %}">
        </div>
        <div class="col-md-3">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                <i class="bi bi-arrow-clockwise me-2"></i>{% trans 'Clear Filters' %}
            </button>
        </div>
    </div>
</div>

<!-- Inventory Grid -->
<div class="row" id="inventoryGrid">
    {% for item in inventory_items %}
    <div class="col-xl-3 col-lg-4 col-md-6 mb-4 inventory-item">
        <div class="dashboard-card h-100">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="item-category">
                    <span class="badge bg-secondary">{{ item.category|default:"General" }}</span>
                </div>
                <div class="dropdown">
                    <button class="btn btn-link btn-sm p-0" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">
                            <i class="bi bi-eye me-2"></i>{% trans 'View Details' %}
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <i class="bi bi-pencil me-2"></i>{% trans 'Edit' %}
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#" onclick="deleteItem({{ item.id }})">
                            <i class="bi bi-trash me-2"></i>{% trans 'Delete' %}
                        </a></li>
                    </ul>
                </div>
            </div>

            <div class="text-center mb-3">
                <div class="item-icon mb-2">
                    {% if item.category == 'camera' %}
                        <i class="bi bi-camera text-primary" style="font-size: 2rem;"></i>
                    {% elif item.category == 'audio' %}
                        <i class="bi bi-mic text-success" style="font-size: 2rem;"></i>
                    {% elif item.category == 'lighting' %}
                        <i class="bi bi-lightbulb text-warning" style="font-size: 2rem;"></i>
                    {% elif item.category == 'computer' %}
                        <i class="bi bi-laptop text-info" style="font-size: 2rem;"></i>
                    {% else %}
                        <i class="bi bi-box text-secondary" style="font-size: 2rem;"></i>
                    {% endif %}
                </div>
                <h6 class="item-title mb-1">{{ item.name|truncatechars:30 }}</h6>
                {% if item.serial_number %}
                <small class="text-muted">{{ item.serial_number }}</small>
                {% endif %}
            </div>

            <div class="item-details">
                <div class="row text-center">
                    <div class="col-6">
                        <small class="text-muted d-block">{% trans 'Status' %}</small>
                        {% if item.is_available %}
                            <span class="badge bg-success">{% trans 'Available' %}</span>
                        {% elif item.is_rented %}
                            <span class="badge bg-warning">{% trans 'Rented' %}</span>
                        {% elif item.is_maintenance %}
                            <span class="badge bg-danger">{% trans 'Maintenance' %}</span>
                        {% else %}
                            <span class="badge bg-secondary">{% trans 'Unknown' %}</span>
                        {% endif %}
                    </div>
                    <div class="col-6">
                        <small class="text-muted d-block">{% trans 'Location' %}</small>
                        <small>{{ item.location|default:"Storage" }}</small>
                    </div>
                </div>

                {% if item.last_inspection %}
                <div class="mt-3 pt-3 border-top">
                    <small class="text-muted">{% trans 'Last Inspection' %}: {{ item.last_inspection|date:"d.m.Y" }}</small>
                </div>
                {% endif %}
            </div>

            <div class="mt-3 pt-3 border-top">
                <div class="d-grid">
                    {% if item.is_available %}
                        <a href="#" class="btn btn-sm btn-primary">
                            <i class="bi bi-calendar-plus me-1"></i>{% trans 'Rent' %}
                        </a>
                    {% else %}
                        <button class="btn btn-sm btn-secondary" disabled>
                            <i class="bi bi-lock me-1"></i>{% trans 'Not Available' %}
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="dashboard-card text-center py-5">
            <div class="text-muted">
                <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                <p class="mt-3">{% trans 'No inventory items found' %}</p>
                <a href="#" class="btn btn-primary">{% trans 'Add your first item' %}</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if is_paginated %}
<nav aria-label="{% trans 'Inventory pagination' %}" class="mt-4">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1">&laquo; {% trans 'First' %}</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">{% trans 'Previous' %}</a>
            </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link">
                {% trans 'Page' %} {{ page_obj.number }} {% trans 'of' %} {{ page_obj.paginator.num_pages }}
            </span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">{% trans 'Next' %}</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">{% trans 'Last' %} &raquo;</a>
            </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const categoryFilter = document.getElementById('categoryFilter');
    const statusFilter = document.getElementById('statusFilter');
    const locationFilter = document.getElementById('locationFilter');
    const searchInput = document.getElementById('searchInput');

    [categoryFilter, statusFilter, locationFilter, searchInput].forEach(filter => {
        filter.addEventListener('change', filterInventory);
        if (filter === searchInput) {
            filter.addEventListener('input', filterInventory);
        }
    });
});

function filterInventory() {
    const category = document.getElementById('categoryFilter').value.toLowerCase();
    const status = document.getElementById('statusFilter').value.toLowerCase();
    const location = document.getElementById('locationFilter').value.toLowerCase();
    const search = document.getElementById('searchInput').value.toLowerCase();

    const items = document.querySelectorAll('.inventory-item');

    items.forEach(item => {
        let show = true;

        // Category filter
        if (category && !item.querySelector('.item-category').textContent.toLowerCase().includes(category)) {
            show = false;
        }

        // Status filter
        if (status && !item.querySelector('.item-details .badge').textContent.toLowerCase().includes(status)) {
            show = false;
        }

        // Location filter
        if (location && !item.querySelector('.item-details small:last-child').textContent.toLowerCase().includes(location)) {
            show = false;
        }

        // Search filter
        if (search) {
            const text = item.textContent.toLowerCase();
            if (!text.includes(search)) {
                show = false;
            }
        }

        item.style.display = show ? '' : 'none';
    });
}

function clearFilters() {
    document.getElementById('categoryFilter').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('locationFilter').value = '';
    document.getElementById('searchInput').value = '';
    filterInventory();
}

function deleteItem(itemId) {
    if (confirm('{% trans "Are you sure you want to delete this inventory item?" %}')) {
        // Add delete functionality here
        console.log('Deleting item:', itemId);
    }
}
</script>
{% endblock %}
