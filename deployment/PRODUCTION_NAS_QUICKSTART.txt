â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PRODUCTION: ĞœĞ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ NAS Ğ½Ğ° Debian 11 (Ğ±ĞµĞ· Docker)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ Ğ¡Ğ¦Ğ•ĞĞĞ Ğ˜Ğ™:
   - Playout: \\192.168.188.1\sendedaten
   - Archive: \\Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹_ip\archive (Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ°Ğ´Ñ€ĞµÑ!)
   - ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ: gunicorn Ğ½Ğ° Debian 11 VM

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 1: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²

sudo apt update
sudo apt install -y cifs-utils ffmpeg

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 2: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ñ‡ĞµĞº Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

sudo mkdir -p /mnt/nas/playout
sudo mkdir -p /mnt/nas/archive
sudo chmod 755 /mnt/nas

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ credentials Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

# Playout credentials
sudo nano /root/.smbcredentials_playout

username=Ñ‚Ğ²Ğ¾Ğ¹_Ğ»Ğ¾Ğ³Ğ¸Ğ½_playout
password=Ñ‚Ğ²Ğ¾Ğ¹_Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
domain=WORKGROUP

# Archive credentials (Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹!)
sudo nano /root/.smbcredentials_archive

username=Ñ‚Ğ²Ğ¾Ğ¹_Ğ»Ğ¾Ğ³Ğ¸Ğ½_archive
password=Ñ‚Ğ²Ğ¾Ğ¹_Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ
domain=WORKGROUP

# Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ñ‹
sudo chmod 600 /root/.smbcredentials_*

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 4: ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° /etc/fstab

sudo nano /etc/fstab

# Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ² ĞºĞ¾Ğ½ĞµÑ†:

# NAS Playout - 192.168.188.1
//192.168.188.1/sendedaten  /mnt/nas/playout  cifs  credentials=/root/.smbcredentials_playout,uid=1000,gid=1000,file_mode=0755,dir_mode=0755,vers=3.0,_netdev,nofail  0  0

# NAS Archive - Ğ—ĞĞœĞ•ĞĞ˜ IP!
//192.168.XXX.XXX/archive  /mnt/nas/archive  cifs  credentials=/root/.smbcredentials_archive,uid=1000,gid=1000,file_mode=0755,dir_mode=0755,vers=3.0,_netdev,nofail  0  0

âš ï¸  Ğ’ĞĞ–ĞĞ: Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸ uid=1000,gid=1000 Ğ½Ğ° ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ gunicorn!
   Ğ£Ğ·Ğ½Ğ°Ñ‚ÑŒ ID: id -u www-data && id -g www-data

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 5: ĞœĞ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

# Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
sudo mount -a

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°
mount | grep cifs
ls -la /mnt/nas/playout
ls -la /mnt/nas/archive

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 6: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ production.cfg

# Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑĞ²Ğ¾Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
sudo nano /path/to/okmq-production.cfg

[media]
archive_path = /mnt/nas/archive/
playout_path = /mnt/nas/playout/
auto_scan = False
auto_copy_on_schedule = True

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 7: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ gunicorn systemd service

sudo nano /etc/systemd/system/oktools.service

[Unit]
Description=OK Tools Gunicorn
After=network.target postgresql.service
# â¬‡ï¸ Ğ”ĞĞ‘ĞĞ’Ğ¬ Ğ­Ğ¢Ğ˜ Ğ¡Ğ¢Ğ ĞĞšĞ˜:
Requires=mnt-nas-playout.mount mnt-nas-archive.mount
After=mnt-nas-playout.mount mnt-nas-archive.mount

[Service]
Type=notify
User=www-data
Group=www-data
WorkingDirectory=/opt/ok-tools
Environment="PATH=/opt/ok-tools/venv/bin"
ExecStart=/opt/ok-tools/venv/bin/gunicorn ok_tools.wsgi:application --bind 127.0.0.1:8000

[Install]
WantedBy=multi-user.target

# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ
sudo systemctl daemon-reload
sudo systemctl restart oktools.service

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 8: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°

# ĞÑ‚ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ gunicorn
sudo -u www-data ls -la /mnt/nas/playout
sudo -u www-data ls -la /mnt/nas/archive

# Ğ¢ĞµÑÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
sudo -u www-data touch /mnt/nas/playout/test.txt
sudo -u www-data rm /mnt/nas/playout/test.txt

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 9: Django Admin - ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Storage Locations

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹: https://your-domain.de/admin/
2. Media Files â†’ Storage locations â†’ Add

   Playout:
   --------
   Name: Production Playout
   Type: PLAYOUT
   Path: /mnt/nas/playout/
   Description: Sendedaten - 192.168.188.1

   Archive:
   --------
   Name: Production Archive
   Type: ARCHIVE
   Path: /mnt/nas/archive/
   Description: Archive - 192.168.XXX.XXX

3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–ˆ Ğ¨ĞĞ“ 10: ĞŸĞµÑ€Ğ²Ğ¾Ğµ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

source /opt/ok-tools/venv/bin/activate
cd /opt/ok-tools
python manage.py scan_video_storage

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”§ ĞŸĞĞ›Ğ•Ğ—ĞĞ«Ğ• ĞšĞĞœĞĞĞ”Ğ«:

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
mount | grep cifs

# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¼Ğ¾Ğ½Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· systemd
sudo systemctl status mnt-nas-*.mount

# Ğ ĞµĞ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
sudo systemctl restart mnt-nas-playout.mount
sudo systemctl restart mnt-nas-archive.mount

# Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ gunicorn
sudo systemctl status oktools.service

# Ğ›Ğ¾Ğ³Ğ¸ gunicorn
sudo journalctl -u oktools.service -f

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ°Ğ² Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°
sudo -u www-data ls -la /mnt/nas/playout

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” TROUBLESHOOTING:

ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: "Host is down"
â†’ ping 192.168.188.1
â†’ smbclient -L //192.168.188.1 -U username

ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: "Permission denied"
â†’ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ uid/gid Ğ² fstab
â†’ id -u www-data && id -g www-data

ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: NAS Ğ½Ğµ Ğ¼Ğ¾Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
â†’ sudo systemctl enable mnt-nas-playout.mount
â†’ sudo systemctl enable mnt-nas-archive.mount

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– ĞŸĞĞ›ĞĞĞ¯ Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢ĞĞ¦Ğ˜Ğ¯: deployment/NAS_DEBIAN_SETUP.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

